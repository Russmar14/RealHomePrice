---
title: "Untitled"
output: html_document
date: "2022-11-22"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
install.packages("caTools")
install.packages('neuralnet')
install.packages('sigmoid')
```


```{r loading packages}

library(tidyverse)
library(dplyr)
library(ggplot2)
library(neuralnet)
library(sigmoid)
library(broom)
library(caTools)
```

## R Markdown


```{r}
realtor_data <- read_csv("/Users/russellmarvin/Downloads/realtor-data.csv")
```

```{r selecting required columns}
realtor_data1 <- realtor_data %>%
  select(c('price','bed','bath','house_size'))

realtor_data1
```

```{r  removing rows with null values}

cleaned_realtordata <- na.omit(realtor_data1)

## manually filtering the ouliers
filtered_realtor_data  <- cleaned_realtordata |> filter(price < 1000000 && bed < 15 && bath < 9 && acre_lot > 0 && acre_lot < 5000 && house_size < 10000 )


## removing the price outliers 
outliers=boxplot(filtered_realtor_data$price,plot=FALSE)$out
outliers_data=filtered_realtor_data[which(filtered_realtor_data$price %in% outliers),]
filtered_realtor_data1= filtered_realtor_data[-which(filtered_realtor_data$price %in% outliers),]

cleaned_realtordata <- filtered_realtor_data1
```

```{r}
filtered_realtor_data <- cleaned_realtordata |> filter(price < 1000000 && bed < 15 && bath < 9 && house_size < 10000 )
```

```{r}
outliers=boxplot(filtered_realtor_data$price,plot=FALSE)$out
outliers_data=filtered_realtor_data[which(filtered_realtor_data$price %in% outliers),]
filtered_realtor_data1= filtered_realtor_data[-which(filtered_realtor_data$price %in% outliers),]
cleaned_realtordata <- filtered_realtor_data1
```



```{r Normalization and Splitting data}




normalize2 <- function(x, na.rm = TRUE) {
    return((x- min(x)) / max(x))
}

normalized_data2 = as.data.frame(lapply(cleaned_realtordata, normalize2))

#min <- apply(cleaned_realtordata, 2, -min/max)
#max <- apply(cleaned_realtordata, 2, max)
#Scaled_data <- as.data.frame(scale(cleaned_realtordata, center = min, scale = max - min))
set.seed(12)
sample <- sample.split(normalized_data2$price, SplitRatio = 0.8)
train_data <- subset(normalized_data2, sample == TRUE)
test_data <- subset(normalized_data2, sample == FALSE)
```




```{r Getting Linear model setup}
linear_model_fit <- lm(price~bed+bath+house_size, data =train_data )
#quick summary of our model
summary(linear_model_fit)
#using tidy() to create a tibble of coefficients to use for neural network weights later
#weights_table <- tidy(linear_model_fit)
#user_data = data.frame(bed, bath, acre_lot, house_size)
```


```{r User input}
{
    bed2 = as.numeric(readline("Enter bed : "));
    bath2 = as.numeric(readline("Enter bath : "));
    house_size2 = as.numeric(readline("Enter house_size: "));
    price8 = as.numeric(readline("Enter price: "));
}
# using (-min/max-min)

bed = (bed2-min(cleaned_realtordata$bed))/(max(cleaned_realtordata$bed)-min(cleaned_realtordata$bed))

bath = (bath2-min(cleaned_realtordata$bath))/(max(cleaned_realtordata$bath)-min(cleaned_realtordata$bath))

acre_lot =(acre_lot2-min(cleaned_realtordata$acre_lot))/(max(cleaned_realtordata$acre_lot)-min(cleaned_realtordata$acre_lot))

house_size = (house_size2-min(cleaned_realtordata$house_size))/(max(cleaned_realtordata$house_size)-min(cleaned_realtordata$house_size))

price10 = (price8-min(cleaned_realtordata$price))/(max(cleaned_realtordata$price)-min(cleaned_realtordata$price))



#   using (- min/max)
bed = (bed2-min(cleaned_realtordata$bed))/(max(cleaned_realtordata$bed))

bath = (bath2-min(cleaned_realtordata$bath))/(max(cleaned_realtordata$bath))

house_size = (house_size2-min(cleaned_realtordata$house_size))/(max(cleaned_realtordata$house_size))




user_data = data.frame(bed, bath, house_size)

```

```{r Using a function}
predict_func <- function(user_data) {
  predict(linear_model_fit, user_data)
}
predict_func

```

```{r}
pricelm <- predict_func(user_data)
pricelm

#unscaling linear model price prediction
unscaled_lm_price <- pricelm*(max(cleaned_realtordata$price))+min(cleaned_realtordata$price)
unscaled_lm_price

```




```{r}
library(sigmoid)



nn <- neuralnet(price~bed+bath+house_size,data=train_data,hidden=2, threshold=0.001,act.fct=relu, rep=1, algorithm = "rprop+", linear.output=TRUE)
            
```




```{r}
#plotting
plot(nn)
#predicting price
price2 <- predict(nn,user_data)

d <- price2[1]  
d
#unscaling price
unscaled_price2 <- d*(max(cleaned_realtordata$price))+min(cleaned_realtordata$price)
unscaled_price2
```

```{r}
usethis::use_testthat()
```


```{r}
library(devtools)
library(usethis)

devtools::check()
```

